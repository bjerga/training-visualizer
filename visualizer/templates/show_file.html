{% extends "layout.html" %}
{% block body %}
    {% if meta and content %}
        <title>Uploaded file</title>
        <form action="{{ url_for('run_upload', username=username, filename=filename) }}" method=post class=run_upload>
            <h2>{{ meta.filename }} {{ form.run }}</h2>
        </form>
        <div>Tags:
            {% for tag in meta.tags %}
                <form method=post style="display:inline"
                      action="{{ url_for('remove_tag', username=username, filename=filename, tag_id=tag.id) }}">
                    <span class=tag>{{ tag }} <button class=remove_tag type="submit">x</button></span>
                </form>
            {% endfor %}

            <form class=tag_form method=post
                  action="{{ url_for('show_file', username=username, filename=filename) }}">
                {{ form.csrf_token }}
                {{ tag_form.tags(placeholder="Add tag") }}
            </form>
        </div>
        <dl>
            <dt>Date uploaded: {{ meta.upload_date }}
            <dt>Owner: {{ meta.owner }}
            <dt>Path: {{ meta.path }}
        </dl>
        <textarea class="code" disabled rows=20 cols=90 >{{ content }}</textarea>

        <h3>Visualization of training process:</h3>

{#            TODO: make if-statement dependent on image-source #}
            {% if has_plot %}
                <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
                <script>window.jQuery || document.write('<script src="{{ url_for('static', filename='jquery.js') }}">\x3C/script>')</script>

                <script>
                $(setInterval(
                        function(){
                            $.ajax({
                                type: 'GET',
                                cache: false,
                                url: "{{ url_for('get_plot', username=username, filename=filename) }}",
                                success: function(response){
                                    $('img').attr('src', response.image_path);
                                    $('#img_path').html(response.image_path);
                                }
                            });
                        },
                        1000)
                );
                </script>

                <img src="">
                <dd>File source: <span id=img_path>?</span>
                <dd>URL source: {{ url_for('get_plot', username=username, filename=filename) }}
            {% else %}
                <dd><em>No plots produced yet</em>
            {% endif %}
    {% endif %}
{% endblock %}